370. Module Introduction
    - Planning a Rest API
    - CRUD Opetations & End points
    - Validation
    - Image Upload
    - Authentication

371. REST APIs & The Rest Of The Course
    ? How do we adjust our knowlegde working with a Rest API instead of a view based application?

    Let's Organize all main topics we learnt (in the left as we learnt, in the right differences for Rest APIs):

        - NODE + Express App Setup      |       No Changes
        - Routing / Endpoints      |       Just more http methods
        - Handling Req & Res      |       Parse + Send JSON files (instead of views)
        - Request Validation      |       No Changes
        - DataBase Communication      |       No Changes
        - Files Uploads & Downloads      |       No real changes (Only in the client side)
        - Sessions & Cookies      |       There is no more
        - Authentication      |       A Different Authentication Approach

    - No real changes, just more http methods

    - Work with JSON data instead of Views

373. Planning the API
    - Summing up,. we just had a look at the files in th ereact app that we will need to fetch some data from the API

374. Fetching Lists of Posts
    * We just set the URL in the frontend, and set some parameters in the backend controller

375. Adding a Create Post Endpoint
    * We set some parameters to the end point, in the server and in the front end code

376. Adding Server Side Validation
    - install express-validator
        * added the validators in the feed routes
    
    ! * to check the error from the server-side, we shuld go to:
        Dev tools -> network -> look for the post data error (in red) -> Look the data (Preview, Headers adn Repsonse mainly)

377. Setting Up a Post Model
    * Let's add ome database logic

    Steps:
        1- npm isntall mongoose
        2- In the app.js, require mongoose
        3- Set the env keys with passwords
        4- mongoose.connect('url').then(app.listen(8080))
        5- Create models folder;
        6- Create our model Schema - mongoose.Schema()

        * Mongoose have some options to the schema set up, now we are using timestamps, to save the time for creation and editing of data

378. Storing Posts in the Database
    * We worked in the feed controller
        - Summing up, it's about saving in the DB, and returning the promisse value (which contains the saved object)

379. Static Images & Error Handling

    - We created a middleware (in app.js), only to serve our images (those that we already have it)
        app.use("/images", express.static(path.join(__dirname, "images")))
    
    - Error handling:
        1. Create the logic for moving with errors for the next middleware in the controllers
            * IN sync codes, we throw the error
            * In async code, we must call next(err)
        2. Register the errorHandling middleware (in app.js)

380. Fetching a Single Post
    * We created a new route and a new controller

    - In the router, set a get route, setting dinamic id for the post;

    - In the controller, the 'regular' logic:
        - Get the post id via req.params (we set it in the route)
        - Look for the post in the db
            - if error, throw error
            - If ok, status(200) and return a JSON
        - And a catch logic, for sending the error to the express error handler

    - In the end, reviewed the front end to get the json data from the rght URL

381.

Instead of

    const storage = multer.diskStorage({
        destination: function(req, file, cb) {
            cb(null, 'images');
        },
        filename: function(req, file, cb) {
            cb(null, new Date().toISOString() + file.originalname);
        }
    });

which we'll write in the next lecture, you should use this slightly modified version:

    const { v4: uuidv4 } = require('uuid');
    
    const storage = multer.diskStorage({
        destination: function(req, file, cb) {
            cb(null, 'images');
        },
        filename: function(req, file, cb) {
            cb(null, uuidv4())
        }
    });
For this, install the uuid package by running:

    npm install --save uuid

382. Uploading Images
    * Main changes only in the client-side

    - Installed multer and uuid in the api
        * Multer is a node.js middleware for handling multipart/form-data, which is primarily used for uploading files
        * We installed uuid (Universally Unique Identifier), but I think it's just for creating randomic keys in the files name (i'm not sure)

        1. install multer;
        2. Set middlewares in App.js
            2.1. require both
                const multer = require("multer");
                const { v4: uuidv4 } = require("uuid");

            2.2. craete filestorage - Setting the destination and the filename

                const fileStorage = multer.diskStorage({
                    destination: (req, file, cb) => {
                        cb(null, "images");
                    },
                    filename: (req, file, cb) => {
                        cb(null, uuidv4());
                    },
                });

                const fileFilter = (req, file, cb) => {
                    if (
                        file.mimetype === "image/png" ||
                        file.mimetype === "image/jpg" ||
                        file.mimetype === "image/jpeg"
                    ) {
                        cb(null, trues);
                    } else {
                        cb(null, false);
                    }
                };
            2.3. create multer middleware:
               app.use(multer().single("image"));            // 'image' is the name of the field in our form that will carry the file

        3. Work in the controller:
            3.1. Set the logic for an error
                  if (!req.file) {
                    const error = new Error("No Image Provided!");
                    error.statusCode = 422;
                    throw error;
                }

            3.2. Create the logic for handling the file
                const imageUrl = req.file.path; // Multer generates the path (as it was stored in the server - from my destination field when setting multer fileStorage)
        
        4.  Set the headers of the formData in the Front End (to append the image and texts)
            * We manage to make it automatically, so we deleted the headers content json stuff;

            const formData = new FormData();
            formData.append("title", postData.title);
            formData.append("content", postData.content);
            formData.append("image", postData.image);

                fetch(url, {
                    method,
                    body: formData,
                })

383. Updating Posts
    - Right now, the CRUD operations are missing
        * We are gonna work in editing and deleting posts, before the authentication part

    - Working on Edit post:
        - router.put('post/:postId', controller)
        - On the controller, we created the logic to check errors, and update the post details
    
    * On the front end we have to adjust also


SOME TROBLUE ON MY IMAGE UPLOAD WHEN i EDIT!








